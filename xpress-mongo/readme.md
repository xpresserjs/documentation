# xpress-mongo - Documentation

[Npm](https://npmjs.org/package/xpress-mongo) | [Git](https://github.com/xpresserjs/xpress-mongo)
| [Change Logs](../change-logs/2021-xm.md)

**xpress-mongo** is a light mongodb model/helper library for nodejs that provides modeling for your documents while
keeping you very close to mongodb native syntax which is always **Recommended**.

For Example.

```javascript
modelInstance.native().findOne({}) // Mongodb native query
```

The `.native()` model instance method allows you run raw mongodb native queries.

<small>
<strong>Note:</strong> xpress-mongo is not bond to xpresser framework but was built by same developers, so we decided to host its documentation
</small>

## Menu

- [Installation](#installation)
- [Model](./model.md)
- [Schema](./schema.md)
- [Joi Schema](./joi-schema.md)
- [Events](./events.md)

## Installation

Using Package Managers.
:::: xTabs NPM|YARN
::: xTab NPM

```sh
npm i xpress-mongo
```

:::
::: xTab YARN

```sh
yarn add xpress-mongo
```

:::
::::

## Connection

:::: xTabs xpress-mongo|mongodb
::: xTab xpress-mongo

```javascript
const {Client} = require('xpress-mongo');
// Replace the uri string with your MongoDB deployment's connection string.
const uri = "mongodb+srv://<user>:<password>@<cluster-url>?retryWrites=true&w=majority";

const connection = Client(uri);

async function run() {
  try {
    await connection.connect();
    // Set Database name
    connection.useDb('sample_mflix');
    // Get Model for collection movies
    const Movies = connection.model('movies');
    
    // Query for a movie that has the title 'Back to the Future'
    const query = {title: 'Back to the Future'};
    const movie = await Movies.findOne(query);
    
    console.log(movie);
  } finally {
    connection.client.close();
  }
}

run().catch(console.dir)
```

:::
::: xTab mongodb 

Example using default [mongodb](https://docs.mongodb.com/drivers/node/quick-start#set-up-your-project)
driver which xpress-mongo is built on.

```javascript
const {MongoClient} = require("mongodb");
// Replace the uri string with your MongoDB deployment's connection string.
const uri = "mongodb+srv://<user>:<password>@<cluster-url>?retryWrites=true&w=majority";

const client = new MongoClient(uri);

async function run() {
  try {
    await client.connect();
    
    const database = client.db('sample_mflix');
    const collection = database.collection('movies');
    
    // Query for a movie that has the title 'Back to the Future'
    const query = {title: 'Back to the Future'};
    const movie = await collection.findOne(query);
    
    console.log(movie);
  } finally {
    // Ensures that the client will close when you finish/error
    await client.close();
  }
}

run().catch(console.dir);
```

:::
::::

## Quick Example

create a file **xmongo.js**

```javascript
const {Client} = require('xpress-mongo');

async function run() {
  // Initialise connection
  const connection = Client('mongodb://127.0.0.1:27017', {
    useNewUrlParser: true,
    useUnifiedTopology: true
  });
  
  try {
    // Try Connecting
    await connection.connect();
    // Set Database name
    connection.useDb('xmongo');
    
    console.log('Connected to mongodb')
  } catch (e) {
    throw e;
  }
  
  // Your Model extends a class for your collection
  class User extends connection.model('users') {
    
    /**
     * Returns the full name of the user.
     * @return {string}
     */
    fullName() {
      return this.data.firstName + ' ' + this.data.lastName
    }
  }
  
  // Find one user in users collection
  let user = await User.findOne({});
  
  // If user is found
  if (user) {
    // Log user and full name
    console.log(user);
    return console.log(`Fullname: ${user.fullName()}`)
  }
  
  console.log('No user found, creating one....');
  
  // Create new user
  user = await User.new({
    firstName: 'John',
    lastName: 'Doe'
  })
  
  // Log user data and full name
  console.log(user);
  return console.log(`FirstName: ${user.fullName()}`)

}

run().catch(console.log)
```

Run the above code, check your database to see if a user was created. After that go through the codes.

#### Line 5-8

The `Client` imported from **xpress-mongo** is being initialised providing Mongodb connection string and options

#### Line 11-20

Try connecting to the mongo server on **Line 13** and after that we set the database name.

#### Line 23-32

These lines shows a basic xpress-mongo Model class for the collection named **users**.
<br>
The `User` class extended a class generated by xpress-mongo for the collection users.
<br/>
The `fullName` method in the `User` class shows a basic example of a Model method and how data is accessed from the
model instance.

#### Line 35-56

On **Line 35** a static method of the model class `User` is used to `findOne` document in the collection. <br/>
The `FindOne` method returns an instance of the User model or `null` if no results.
<br/>
On **Line 47** a new user is created using xpress-mongo `new` static method

## CRUD Example

**Create, Read, Update, and Delete (CRUD)** are the four basic functions that models should be able to do, at most.

### Create a new document

There are two ways to create a document in a collection, **Instant or Buildup**

```javascript
// Instant
const user = await User.new({
  email: 'john@doe.com',
  firstName: 'John',
  lastName: 'Doe'
});

// Buildup
const user = new User();

// set single field
user.set('email', 'john@doe.com');

// set multple fields
user.set({
  firstName: 'John',
  lastName: 'Doe'
});

await user.save();
```

### Read document

```javascript
// Find all, @returns Arrays
const users = await User.find({verified: true});

// Find One, @returns Model instance
const user = await User.findOne({email: 'john@doe.com'});

// Find by Id, @returns Model instance
const user = await User.findById('ObjectID or ObjectID-string');

// Log result.
console.log(user)
```

```
User {
  data: {
    _id: ObjectID,
    email: "john@doe.com",
    firstName: "John",
    lastName: "Doe"
  }
}
```

### Update Document

You can update a model instance document either by using the **buildup** or **instant** method.

```javascript
const user = await User.findOne({email: 'john@doe.com'});

// Build Up
user.set('middleName', 'Donald') // set middleName
await user.save(); // save to database

// Instant
await user.update({middleName: 'Donald'});
```

### Delete Document

```javascript
const user = await User.findOne({email: 'john@doe.com'});
// Delete document
await user.delete();
```

<Pagination/>





