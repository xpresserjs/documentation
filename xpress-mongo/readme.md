# Xpress-Mongo
**xpress-mongo** is a lightweight mongodb collection as model library.
When using mongodb default client for nodejs (which is recommended), most developers have to create a way to make modelling possible. 
With xpress-mongo you get customizable modelling at it's peak.


## Installation
```sh
npm i xpress-mongo
```
```sh
yarn add xpress-mongo
```

## Usage 
create file **mongodb.js**
```javascript
const {Client} = require('xpress-mongo');

async function run() {
    // Initialise connection
    const connection = Client('mongodb://127.0.0.1:27017', {
        useNewUrlParser: true,
        useUnifiedTopology: true
    });


    try {
        // Try Connecting
        await connection.connect();
        // Set Database name
        connection.useDb('xmongo');

        console.log('Connected to mongodb')
    } catch (e) {
        throw e;
    }

    // Your Model extends a class for your collection
    class User extends connection.model('users') {

        /**
         * Returns the full name of the user.
         * @return {string}
         */
        fullName() {
            return this.data.firstName + ' ' + this.data.lastName
        }
    }

    // Find one user in users connection
    let user = await User.findOne({});

    // If user is found
    if (user) {
        // Log user and full name
        console.log(user);
        return console.log(`Fullname: ${user.fullName()}`)
    }

    console.log('No user found, creating one....');

    // Create new user
    user = await User.new({
        firstName: 'John',
        lastName: 'Doe'
    })

    // Log user data and full name
    console.log(user);
    return console.log(`FirstName: ${user.fullName()}`)

}

run().catch(error => console.log(error))
```

Run the above code, check your database to see if a user was created.
After that go through the codes.

#### Line 5-8
The `Client` imported from **xpress-mongo** is being initialised providing Mongodb connection string and options

#### Line 11-20
Try connecting to the mongo server on **Line 13** and after that we set the database name.

#### Line 23-32
These lines show a basic xpress-mongo Model class for the collection named **users**
<br>
The `User` class extended a class generated by xpress-mongo for the collection users.
<br/>
The `fullName` method in the `User` class shows a basic example of a Model method and how data is accessed from the model instance.

#### Line 35-56
On **Line 35** a static method of the model class `User` is used to `findOne` document in the collection. <br/>
The `FindOne` method returns an instance of the User model or `null` if no results.
<br/>
On **Line 47** a new user is created using xpress-mongo `new` static method

## CRUD Example
**Create, Read, Update, and Delete (CRUD)** are the four basic functions that models should be able to do, at most.

### Create a new document
There are two ways to create a document in a collection, **Instant or Buildup** 
```javascript
// Instant
const user = await User.new({
  email: 'john@doe.com',
  firstName: 'John',
  lastName: 'Doe'
});

// Buildup
const user = new User();

user.set({
    firstName: 'John',
    lastName: 'Doe'
});
user.set('email', 'john@doe.com');


await user.save();
```

### Read document
```javascript
// Find all, @returns Array
const user = await User.find({verified: true});

// Find One, @returns Model instance
const user = await User.findOne({email: 'john@doe.com'});

// Find by Id, @returns Model instance
const user = await User.findById('ObjectID or ObjectID-string');

// Log result.
console.log(user)
```
```javascript
User {
    data: {
      _id: ObjectID,
      email: "john@doe.com",
      firstName: "John",
      lastName: "Doe"
    }
}
```

### Update Document
You can update a model instance document either by using the **buildup** or **instant** method.
```javascript
const user = await User.findOne({email: 'john@doe.com'});

// Build Up
user.set('middleName', 'Donald') // set middleName
await user.save(); // save to database

// Instant
await user.update({middleName: 'Donald'});
```

### Delete Document
```javascript
const user = await User.findOne({email: 'john@doe.com'});
// Delete document
await user.delete();
```

<div style="margin-top: 50px; text-align: right">
<a href="/xpress-mongo/model.html"><b>Next &gt;&gt; Model</b></a>
</div>





